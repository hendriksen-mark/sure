<%# locals: (sankey_data:, period:) %>
<div id="cashflow-sankey-chart">
  <div class="flex justify-end items-center gap-4 px-4 mb-4">
    <%= form_with url: root_path, method: :get, data: { controller: "auto-submit-form", turbo_frame: "_top" } do |form| %>
      <%= form.select :period,
                Period.as_options,
                { selected: period.key },
                data: { "auto-submit-form-target": "auto" },
                class: "bg-container border border-secondary font-medium rounded-lg px-3 py-2 text-sm pr-7 cursor-pointer text-primary focus:outline-hidden focus:ring-0" %>
    <% end %>
  </div>
  <% if sankey_data[:links].present? %>
    <div
      data-controller="resizable"
      data-resizable-storage-key-value="cashflow-sankey-height"
      data-resizable-min-height-value="200"
      data-resizable-max-height-value="1200"
      data-resizable-default-height-value="600"
      class="w-full relative">
      <div data-resizable-target="container" class="w-full">
        <div
          data-controller="sankey-chart"
          data-sankey-chart-data-value="<%= sankey_data.to_json %>"
          data-sankey-chart-currency-symbol-value="<%= sankey_data[:currency_symbol] %>"
          class="w-full h-full"></div>
      </div>
      <div
        data-resizable-target="handle"
        data-action="mousedown->resizable#startResize touchstart->resizable#startResize"
        class="absolute bottom-0 left-0 right-0 h-2 cursor-ns-resize flex items-center justify-center group hover:bg-gray-200 transition-colors"
        role="slider"
        aria-valuemin="200"
        aria-valuemax="1200"
        tabindex="0">
        <div class="w-12 h-1 bg-gray-300 rounded-full group-hover:bg-gray-400 transition-colors"></div>
      </div>
    </div>
    <%= render DS::Dialog.new(id: "cashflow-expanded-dialog", auto_open: false, width: "custom", disable_frame: true, content_class: "!w-[96vw] max-w-[1650px]", data: { action: "close->cashflow-expand#restore" }) do |dialog| %>
      <% dialog.with_header(title: t("pages.dashboard.cashflow_sankey.title")) %>
      <% dialog.with_body do %>
        <div class="w-full h-[85dvh] max-h-[90dvh] overflow-y-auto overscroll-contain">
          <div
            data-controller="sankey-chart"
            data-sankey-chart-data-value="<%= sankey_data.to_json %>"
            data-sankey-chart-currency-symbol-value="<%= sankey_data[:currency_symbol] %>"
            class="w-full h-full"></div>
        </div>
      <% end %>
    <% end %>
  <% else %>
    <div class="h-[300px] lg:h-[340px] bg-container py-4 flex flex-col items-center justify-center">
      <div class="space-y-3 text-center flex flex-col items-center">
        <%= render DS::FilledIcon.new(
          variant: :container,
          icon: "activity" # cashflow placeholder icon
        ) %>
        <p class="text-sm font-medium text-primary"><%= t("pages.dashboard.cashflow_sankey.no_data_title") %></p>
        <p class="text-secondary text-sm"><%= t("pages.dashboard.cashflow_sankey.no_data_description") %></p>
        <%= render DS::Link.new(
          text: t("pages.dashboard.cashflow_sankey.add_transaction"),
          icon: "plus",
          href: new_transaction_path,
          frame: :modal
        ) %>
      </div>
    </div>
  <% end %>
</div>
